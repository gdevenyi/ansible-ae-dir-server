#-----------------------------------------------------------------------
# initiate:   systemctl enable ekca_agent.service
# start:      systemctl start ekca_agent.service
# get status: systemctl status ekca_agent.service
#
# {{ ansible_managed }}
#-----------------------------------------------------------------------

[Unit]
Description=EKCA key agent
Requires=network.target
After=network.target
Documentation=https://www.ae-dir.com/ekca.html

[Service]
Type=simple
{% for evar in ekca_agent_env %}
Environment={{ evar }}
{% endfor %}
ExecStartPre=/bin/rm -f {{ ekca_agent_socket }}
ExecStart={{ ekca_ssh_agent }}
User=ae-dir-ekca
Group=ae-dir-ekca
CapabilityBoundingSet=
AmbientCapabilities=
RestrictAddressFamilies=AF_UNIX
RemoveIPC=yes
# various hardening options
{% if aedir_systemd_hardening %}
# various hardening options from ansible var aedir_systemd_hardening
{% for systemd_option in aedir_systemd_hardening %}
{{ systemd_option }}
{% endfor %}
PrivateNetwork=yes
IPAddressDeny=any
MemoryDenyWriteExecute=yes
SystemCallFilter=~ @clock @cpu-emulation @debug @keyring @module @mount @raw-io @reboot @swap @obsolete @chown @timer @privileged fork clone clone2 clone3 @resources
{% endif %}

[Install]
WantedBy=multi-user.target
