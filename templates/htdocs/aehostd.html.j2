{% extends aedir_htdocs_layout %}

{% block head_title %}aehostd -- Custom NSS/PAM demon{% endblock %}
{% block head_pagedescription %}aehostd -- Custom NSS/PAM demon{% endblock %}

{% block content %}

<p>
  <strong>Intended Audience:</strong>
  System architects, developers and system administrators
</p>

<ol>
  <li>
    <a href="#intro">Introduction</a></li>
    <ol>
      <li><a href="#features">Specific features</a></li>
      <li><a href="#maps">NSS maps</a></li>
      <li><a href="#aehost-init">Host password initialization</a></li>
    </ol>
  </li>
  <li>
    <a href="#install">Installation</a>
    <ol>
      <li><a href="#pam-nss-modules">NSS/PAM modules</a></li>
    </ol>
  </li>
  <li>
    <a href="#aehostd-config">Configuration</a>
  </li>
</ol>

<h1 id="intro">Introduction</h1>

<p>
  While you can integrate your Linux systems with any NSS/PAM service demon
  it is highly recommended to use
  <a href="https://pypi.org/project/aehostd/">aehostd</a>,
  a custom NSS/PAM service implemented
  in <a href="https://www.python.org">Python 2.x</a>.
</p>

<p>
  The following diagram illustrates the integration of <em>aehostd</em> into
  Linux login:
</p>

{% set img_anchor="aehostd" -%}
{% set img_file="aehostd.png" -%}
{% set img_title="&AElig;-DIR integration of Linux with aehostd" -%}
{% include "includes/img.html.j2" %}

<h2 id="features">Specific features</h2>
<p>
  Additionally to what you expect by such a service this custom client
  is has specific functionality for use with &AElig;-DIR:
</p>
<ul>
  <li>
    Binds to &AElig;-DIR either with
    <ul>
      <li><em>simple bind</em> (short-DN form)</li>
      <li><em>SASL/EXTERNAL</em> bind when using TLS client certs</li>
    </ul>
  </li>
  <li>
    Sends <em>LDAP Who Am I?</em> extended operation
    (see <a href="https://tools.ietf.org/html/rfc4532">RFC 4352</a>)
    to find the real DN of their own
    <a href="docs.html#schema-oc-aeHost">aeHost</a> entry
    for determining <a href="docs.html#schema-oc-aeSrvGroup">aeSrvGroup</a>
    membership.
  </li>
  <li>
    Without specific client configuration it uses search filters for
    searching user, group and sudoers entries based on the attributes found
    in all relevant
    <a href="docs.html#schema-oc-aeSrvGroup">aeSrvGroup</a>
    entries searched before:
    <ul>
      <li>aeLoginGroups</li>
      <li>aeVisibleGroups</li>
      <li>aeVisibleSudoers</li>
    </ul>
    This gives much better performance when having many POSIX systems
    integrated with &AElig;-DIR.
  </li>
  <li>
    When checking user's password it sends
    <em>Session Tracking</em> extended control along with the simple bind
    request with the IP address of the client system and the user name
    (see <a href="https://tools.ietf.org/html/draft-wahl-ldap-session">draft-wahl-ldap-session</a>).
    This gives more valuable information in &AElig;-DIR slapd logs for auditing.
  </li>
</ul>

<h2 id="maps">NSS maps</h2>
<p>
  The following NSS maps are provided:
  <ul>
    <li>passwd</li>
    <li>group</li>
    <li>hosts</li>
  </ul>
</p>

<p>
  Besides normal <em>group</em> map this demon returns some virtual
  groups to the calling application:
  <ul>
    <li>
      Virtual groups for the individual <var>gidNumber</var> set in
      <a href="docs.html#schema-oc-aeUser-attributes">aeUser</a>.
      entries.
    </li>
    <li>
      Virtual role groups based on
      <a href="docs.html#schema-oc-aeSrvGroup-attributes">
      rights groups attributes</a>
      <table>
        <tr>
          <th>Attribute</th>
          <th>Group name</th>
          <th>GID</th>
        </tr>
        <tr>
          <td>aeVisibleGroups</td>
          <td>ae-vgrp-role-all</td>
          <td>9000</td>
        </tr>
        <tr>
          <td>aeLoginGroups</td>
          <td>ae-vgrp-role-log</td>
          <td>9001</td>
        </tr>
        <tr>
          <td>aeLogStoreGroups</td>
          <td>ae-vgrp-role-login</td>
          <td>9002</td>
        </tr>
        <tr>
          <td>aeSetupGroups</td>
          <td>ae-vgrp-role-setup</td>
          <td>9003</td>
        </tr>
      </table>
    </li>
  </ul>
</p>

<p>
  Example use-cases for virtual role groups:
</p>
<ul>
  <li>
    Allow all <a href="docs.html#role-setup-admin">setup admins</a> mapped
    to virtual role POSIX group <var>ae-vgrp-role-setup</var> to use
    command <code>su</code> with own password
    (see <a href="https://linux.die.net/man/8/pam_wheel">pam_wheel(8)</a>).
  </li>
  <li>
    Allow all users with log view right mapped to virtual role POSIX group
    <var>ae-vgrp-role-log</var> to read log files by simply setting normal
    group ownership and group permissions (no need to sync POSIX ACLs).
  </li>
</ul>

<h2 id="aehost-init">Host password initialization</h2>
<p>
  When using password authentication with a special system user and the
  host password this host password is written to <em>aehostd</em>'s
  configuration file which allows automated initialization and recovery via
  PAM.
</dl>

<h1 id="install">Installation</h1>

<h2 id="pam-nss-modules">NSS/PAM modules</h2>
<p>
    The NSS and PAM front-end modules of
    <a href="#pam-nss-nslcd">nss-pam-ldapd (aka nslcd)</a>
    are used preferrably compiled with different compile-time parameters
    to prevent naming and package collisions with other standard OS packages.<br>
    For example see the compilation options in the .spec file of this package:<br>
    <a href="https://build.opensuse.org/package/show/home:stroeder:AE-DIR/aehostd-modules">
      openSUSE build service: Package <em>aehostd-modules</em>
    </a>
</p>

<h1 id="aehostd-config">Configuration</h1>
<p>
  Example ansible role: <code>ansible/roles/ae-dir-hostd/</code>
  (sets ansible variable <em>nsswitch_module</em> to "aedir")
</p>

{% endblock content %}
