<!--#set var="head_title" value="Installation" -->
<!--#set var="head_pagedescription" value="Installation" -->
<!--#set var="base_path" value="" -->
<!--#include file="ssi/head.shtml" -->

<p>
  <strong>Intended Audience:</strong>
  System administrators
</p>

<ol>
  <li><a href="#support">Support</a></li>
  <li><a href="#prereq">Prerequisites</a></li>
  <li><a href="#install">Installation</a></li>
  <li><a href="#license">Copyright &amp; License</a></li>
  <li><a href="#software">Software / technology used</a></li>
</ol>

<h1 id="support">Support</h1>
<ul>
  <li>
    <a href="mailto:michael@stroeder.com?SUBJECT=Subscribe to ae-dir-users">Subscribe to ae-dir-users</a>
    and get informed about news.
  </li>
  <li>
    If you need more help please consider
    <a href="https://www.stroeder.com/impressum.shtml">commercial support</a>.
  </li>
</ul>

<h1 id="prereq">Prerequisites</h1>
<ol>
  <li>
    Make yourself familiar with the
    <a href="docs.html#sys-arch">system architecture</a>.
  </li>
  <li>
    Install &AElig;-DIR servers with one of the supported operating
    systems. Currently the ansible playbooks support fully automated
    installation/configuration on&hellip;
    <ul>
      <li>
        <a href="https://en.opensuse.org/openSUSE:Tumbleweed_installation">
        openSUSE Tumbleweed</a>
      </li>
      <li>
        <a href="https://www.suse.com">
        SLES 12SP2</a>
      </li>
      <li>
        <a href="https://www.debian.org/releases/jessie/">Debian Jessie</a>
        with OpenLDAP packages from
        <a href="https://ltb-project.org/wiki/documentation/openldap-deb#apt_repository">
          Debian APT repository of LTB project
        </a>
      </li>
      <li>
        <a href="https://www.centos.org/">CentOS 7.3</a>
        with OpenLDAP packages from
        <a href="https://ltb-project.org/wiki/documentation/openldap-rpm#yum_repository">
          YUM repository of LTB project
        </a>
      </li>
    </ul>
    If you want to tweak the ansible roles to install on another OS make
    sure a recent <a href="https://www.openldap.org">OpenLDAP 2.4.44+</a>
    with overlay <em>slapo-deref</em> is available for your OS platform.
    Older releases are explicitly not recommended!
  </li>
  <li>
    The ansible roles needs the following software packages on all target
    machines to be installed:
    <ul>
      <li>Python 2.x</li>
      <li>python-xml</li>
      <li>lsb_release command (package <em>lsb-release</em>)</li>
    </ul>
  </li>
  <li>
    Install on your admin workstation (the <em>ansible controller</em>):
    <ul>
      <li>
        <a href="https://docs.ansible.com/ansible/intro_installation.html">ansible 2.2.0.0+</a>
        (Use Jinja2 2.8.x! <em>ansible</em> does not work with 2.9.x yet!
        (see <a href="https://github.com/ansible/ansible/issues/20063">issue 20063</a>)
      </li>
      <li>
        <a href="https://git-scm.com/book/en/v2/Getting-Started-Installing-Git">git</a>
      </li>
      <li>
        <a href="http://www.dnspython.org">dnspython</a>
      </li>
    </ul>
    Simple approach:
    <pre>
      # virtualenv-2.7 /opt/ansible
      # /opt/ansible/bin/pip2 install --upgrade ansible Jinja2==2.8.1 dnspython
    </pre>
  </li>
  <li>
    Create DNS entries for all your &AElig;-DIR servers:
    <ul>
      <li>
        Don't forget to add correct reverse DNS entries (PTR RRs).
      </li>
      <li>
        While not strictly required it's a good idea to choose a separate DNS
        subdomain especially not matched by any wild-card certificate you
        might use.
      </li>
      <li>
        The DNS should at least contain one dot. Otherwise Chrome web browser
        won't accept/return cookies.
      </li>
    </ul>
  </li>
  <li>
    Prepare to have SSH access to all &AElig;-DIR servers as user
    <em>root</em> (via <code>su</code> or <code>sudo</code>)
  </li>
  <li>
    Make yourself familiar with how to use command-line options for
    <a href="https://docs.ansible.com/ansible/become.html#command-line-options">ansible become</a>.
  </li>
  <li>
    Check whether you can access the hosts with
    <a href="https://docs.ansible.com/ansible/setup_module.html">ansible setup</a>:
    <pre>/opt/ansible/bin/ansible all -i 'hostname.example.com,' -m setup</pre>
    The trailing comma after the FQDN is needed when using a hostname!
  </li>
  <li>
    Get the ansible playbooks:
    <pre>git clone https://ae-dir.com/git/ae-dir.git</pre>
  </li>
  <li>
    Issue X.509 TLS server certificates with appropriate <var>CN</var> and
    <var>subjectAltName</var> values for all replicas with your existing
    PKI's certificate authority.
    <br>
    The anti-security concept of wild-card certificates is not compatible
    with &AElig;-DIR's security concept! Therefore these cannot be used!
    <br>
    If you don't have a PKI yet you can setup a test certificate authority
    (CA) with shell scripts found in <code>tools/pki-scripts/</code>.
  </li>
</ol>

<h1 id="install">Installation</h1>
<ol>
  <li>
    Create environment directory structure (e.g. copy directory <em>example/</em>):
    <code>cp -av example myenv</code>.
  </li>
  <li>
    Edit ansible inventory file <em>myenv/hosts</em> to match your
    hosts/VMs/containers of your installation environment.
  </li>
  <li>
    Read comments in file
    <code>ansible/roles/ae-dir-server/defaults/main.yml</code> and adjust
    <a href="https://docs.ansible.com/ansible/playbooks_variables.html">
    ansible group and host vars</a> to match your environment.
  </li>
  <li>
    Invoke ansible play in sub-directory <code>ansible/</code>
    (here using command <code>su</code>):
    <pre>/opt/ansible/bin/ansible-playbook ae-dir-servers.yml -i myenv/hosts --become -K --become-method=su --extra-vars='{"aedir_init":True, "openldap_keygen":True}'</pre>
    <ul>
      <li>
        At first run this will generate TLS server key and signed CSR file
        and stops with a message where to find the CSR files on your local
        ansible controller.
      </li>
      <li>
        After signing the CSRs with your CA place the server certificate file(s) into
        directory <code>ae-dir/ansible/myenv/files/</code>.
      </li>
      <li>
        Invoke <var>ansible-playbook</var> command above again to proceed
        with installation.
      </li>
    </ul>
  </li>
  <li>
    Log into one provider system become user <em>root</em> and run the
    following commands to fully initialize your directory:
    <ol>
      <li>
        Add the basic &AElig;-DIR entries with OpenLDAP command-line tool:
        <ul>
          <li>
            On SUSE / openSUSE:
            <pre>ldapmodify -f /opt/ae-dir/etc/ae-dir-base.ldif</pre>
          </li>
          <li>
            On Debian:
            <pre>/usr/local/openldap/bin/ldapmodify -f /opt/ae-dir/etc/ae-dir-base.ldif</pre>
          </li>
        </ul>
      </li>
      <li>
        Set the user password of an initial Ã† admin (here <em>msin</em>):
        <pre>/opt/ae-dir/bin/ae-passwd.py msin</pre>
      </li>
    </ol>
  </li>
  <li>
    Check the systems' health by invoking as <em>root</em> the monitoring
    script on all &AElig;-DIR servers. By default it is installed to:
    <pre>/opt/ae-dir/sbin/slapd_checkmk.sh</pre>
  </li>
</ol>

<h1 id="license">Copyright &amp; License</h1>
<p>
  &copy; 2015-2017 by <a href="https://stroeder.com/impressum.html">Michael Str&ouml;der</a>
</p>
<pre>
  Licensed under the Apache License, Version 2.0 (the "License"); you may
  not use files and content provided on this web site except in compliance
  with the License. You may obtain a copy of the License at

      <a href="http://www.apache.org/licenses/LICENSE-2.0">http://www.apache.org/licenses/LICENSE-2.0</a>

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
</pre>

<h1 id="software">Software / technology used</h1>
<p>
  &AElig;-DIR serves as a good example for
  <a href="https://en.wikipedia.org/wiki/Standing_on_the_shoulders_of_giants">
  standing on the shoulders of giants</a>:
</p>
<ul>
  <li><a href="https://www.kernel.org/">Linux</a></li>
  <li><a href="https://www.openldap.org">OpenLDAP 2.4.x server and client libs</a></li>
  <li><a href="https://www.python.org">Python 2.x</a></li>
  <li><a href="https://git-scm.com/">git</a></li>
  <li><a href="https://www.ansible.com">ansible</a></li>
  <li><a href="https://httpd.apache.org">Apache 2.4.x</a></li>
  <li><a href="https://web2ldap.de">web2ldap</a></li>
  <li><a href="https://python-ldap.org">python-ldap</a></li>
  <li><a href="https://www.stroeder.com/slapdsock.html">slapdsock</a></li>
  <li><a href="https://oath-ldap.stroeder.com/">OATH-LDAP</a></li>
</ul>

<!--#include file="ssi/footer.shtml" -->
