---
# Install CRON jobs

- name: "Set general env vars in {{ aedir_cron_file }}"
  cron:
    env: yes
    name: "{{ item.key }}"
    value: "{{ item.value }}"
    state: present
    user: root
    cron_file: "{{ aedir_cron_file }}"
  with_dict:
    HOME: "{{ aedir_rundir }}"
    MAILTO: ""
    LDAPRC: "{{ aedir_etc }}/ldap.conf"
    PYTHONPATH: "{{ aedir_etc }}/ae-dir-pwd"

- name: "Set Python env vars in {{ aedir_cron_file }}"
  cron:
    env: yes
    name: "{{ item.name }}"
    value: "{{ item.value }}"
    state: present
    user: root
    cron_file: "{{ aedir_cron_file }}"
  loop: "{{ aedir_python_env }}"

- name: "Remove obsolete metrics text export CRON job"
  cron:
    name: "slapd_metrics"
    state: absent
    cron_file: "{{ aedir_cron_file }}"

- name: "Role-specific CRON jobs"
  include_tasks: "cron_{{ openldap_role }}.yml"
