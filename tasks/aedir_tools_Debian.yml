---

- name: "Install base packages on {{ lsb_id }}"
  apt:
    name: "{{ item }}"
    state: installed
    update_cache: no
    install_recommends: no
    dpkg_options: 'force-confold,force-confdef'
  with_items:
    - cron
    - python
    - python-paramiko
    - python-webpy
    - tar
    - gzip
    - gcc
    - libssl-dev
    - libsasl2-dev
    - libldap-dev
    - python-dev
    - libpython-dev
    - python-setuptools
    - virtualenv
    - python-virtualenv
    - python-pip
    - libffi-dev
    - python-cffi

- name: "PIP install modules in virtualenv {{ aedir_prefix }}"
  pip:
    name: "{{ item }}"
    state: latest
    virtualenv: "{{ aedir_prefix }}"
    virtualenv_site_packages: yes
    extra_args: "--upgrade"
  with_items:
    - python-ldap
    - pyasn1
    - pyasn1_modules
    - aedir
    - slapdsock
    - netaddr
    - cryptography
    - jwcrypto

- name: "Install additional base packages on {{ openldap_role }} on {{ lsb_id }}"
  apt:
    name: "{{ item }}"
    state: installed
    update_cache: no
    install_recommends: no
    dpkg_options: 'force-confold,force-confdef'
  with_items:
    - python-paramiko
    - python-webpy
  when: openldap_role=="provider"

- name: "PIP install additional modules on {{ openldap_role }} on {{ lsb_id }}"
  pip:
    name: "{{ item }}"
    state: latest
    virtualenv: "{{ aedir_prefix }}"
    virtualenv_site_packages: yes
    extra_args: "--upgrade"
  with_items:
    - mailutil
    - oath
    - passlib
  when: openldap_role=="provider"
