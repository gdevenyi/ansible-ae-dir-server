---
# monitoring stuff

- name: "Remove {{ aedir_sbin }}/slapd_checkmk.py"
  file:
    path: "{{ aedir_sbin }}/slapd_checkmk.py"
    state: absent

- name: "PIP install slapdcheck in virtualenv {{ aedir_prefix }}"
  pip:
    name:
      - slapdcheck>=3.1.0
    state: present
    virtualenv: "{{ aedir_prefix }}"
    extra_args: "{{ aedir_pip_extra_args }}"
  when: lsb_id != 'SUSE'

- name: "Install slapdcheck package on {{ openldap_role }}"
  zypper:
    name:
      - slapdcheck >= 3.1.0
    state: present
    disable_recommends: yes
    type: package
  when: lsb_id == 'SUSE'

- name: "Check status of directory {{ slapd_checkmk_local }}"
  stat:
    path: "{{ slapd_checkmk_local }}"
  register: slapd_checkmk_local_stat

- name: "Install local check {{ slapd_checkmk_local }}/slapd_checkmk.sh"
  template:
    src: "slapd_checkmk.sh.j2"
    dest: "{{ slapd_checkmk_local }}/slapd_checkmk.sh"
    owner: root
    group: root
    mode: 0755
  when: slapd_checkmk_local_stat.stat.isdir is defined and slapd_checkmk_local_stat.stat.isdir
