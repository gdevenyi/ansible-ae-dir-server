---
# defaults file for roles/ae-dir


#---------------------------------------------------------------------------
# AE-DIR parameters
#---------------------------------------------------------------------------

# base DN / search root for AE-DIR entries
aedir_suffix: "ou=ae-dir"

# POSIX-UID number range served by AE-DIR
aedir_min_uid: 30000
aedir_max_uid: 59999

# POSIX-GID number range served by AE-DIR
aedir_min_gid: 30000
aedir_max_gid: 59999

# fixed primary POSIX-GID in all posixAccount entries
aedir_global_gid: "{{ aedir_min_uid }}"

# Parameters for generating user names
aedir_username_length: 4
aedir_username_gen_trials: 15

# Usernames and POSIX-UID/-GID numbers for system accounts of services
# running on providers and accessing AE-DIR via LDAPI
# (should be outside ranges defined above)
aedir_ldapi_services:
  - uid: ldap
    cn: OpenLDAP slapd demon user
    uid_number: 108
    gid_number: 113
    description: The system user for running OpenLDAP server process (slapd)
  - uid: system_pwd_self_service
    cn: Password self-service application
    uid_number: 998
    gid_number: 998
    description: The system user allowed to set attributes during user password reset (msPwdResetObject) over LDAPI
  - uid: system_person_sync
    cn: Personnel data sync process
    uid_number: 999
    gid_number: 999
    description: The system user allowed to maintain aePerson entries over LDAPI

# Some paths for tools
aedir_prefix: "/opt/ae-dir"
aedir_bin: "/opt/ae-dir/bin"
aedir_rundir: "/opt/ae-dir/run"

#---------------------------------------------------------------------------
# OpenLDAP parameters
#---------------------------------------------------------------------------

# which Debian repo to use for LTB OpenLDAP builds
ltb_openldap_repo_source: "deb http://ltb-project.org/debian/{{ ansible_distribution_release }} {{ ansible_distribution_release }} main"
ltb_openldap_repo_key: "http://ltb-project.org/wiki/lib/RPM-GPG-KEY-LTB-project"

# default FQDN in LDAP service URL
openldap_service_fqdn: "{{ inventory_hostname }}"

# Some paths
openldap_prefix: "/usr/local/openldap"
openldap_bin: "{{ openldap_prefix }}/bin"
openldap_conf_prefix: "{{ openldap_prefix }}/etc/openldap"
openldap_schema_prefix: "{{ openldap_prefix }}/etc/openldap/schema"
openldap_sbin: "{{ openldap_prefix }}/sbin"
openldap_defaults: "/etc/default/slapd"
openldap_rundir: "{{ openldap_prefix }}/var/run"
openldap_data: "{{ openldap_prefix }}/var/openldap-data"
openldap_conf_file: "{{ openldap_conf_prefix }}/slapd.conf"
openldap_ldapi_socket: "{{ openldap_rundir }}/ldapi"
openldap_ldapi_uri: "ldapi://{{ openldap_ldapi_socket|urlencode|replace('/','%2F') }}"

# Directories with dynamically loadable modules
openldap_module_paths:
  - "{{ openldap_prefix }}/libexec/openldap"

# All additional schema files needed
openldap_schema_files:
  - ae-dir.schema
  - draft-findlay-ldap-groupofentries.schema
  - draft-stroeder-mailboxrelatedobject.schema
  - draft-stroeder-namedobject.schema
  - mspwdreset.schema
  - oath-ldap.schema
  - openssh-lpk_openldap.schema
  - rfc2307bis.schema
  - stroeder.com-oid-macros.schema
  - stroeder.com.schema
  - sudoers.schema

# Provider replicas service hostnames
openldap_providers: []

# Provider consumer service hostnames
openldap_consumers: []

# List of servers to be added to rootDSE attribute altServer (see RFC 4512)
openldap_rootdse_alt_servers: []

# The CA certificate file for validating the server certs
openldap_cacert_filename: "slapd-cacerts.pem"

# Suffix expected in subject-DN of server and client certs
# for authz-regexp directive and pkiUser/seeAlso attributes
openldap_tls_cert_suffix: "OU=ITS,O=Example,C=DE"

# The server certificate and key files
openldap_cert_filename: "{{ openldap_service_fqdn }}.crt"
openldap_key_filename: "{{ openldap_service_fqdn }}.key"

# The full path names on the target system
openldap_cacert_pathname: "{{ openldap_conf_prefix }}/tls/{{ openldap_cacert_filename }}"
openldap_cert_pathname: "{{ openldap_conf_prefix }}/tls/{{ openldap_service_fqdn }}.crt"
openldap_key_pathname: "{{ openldap_conf_prefix }}/tls/{{ openldap_service_fqdn }}.key"

# for generating DH parameters for perfect forward secrecy
openldap_dhparam_pathname: "{{ openldap_conf_prefix }}/tls/slapd.dhparam"
openldap_dhparam_numbits: 2048

# subject alternative names for gen_csr.sh in OpenSSL syntax
openldap_csr_subjectaltnames:
  - "DNS:{{ openldap_service_fqdn }}"

# which messages to send to syslog
# normal for production: stats
openldap_log_level: "stats"

# how many worker threads are started
# RAM needed per thread: 4MB on 32 bit systems, 8MB on 64 bit systems
# rule-of-thumb: 4 per real CPU core
openldap_threads: 8

# Database parameters
openldap_db_accesslog_maxsize: 4000000
openldap_db_um_maxsize: 4000000


#---------------------------------------------------------------------------
# web2ldap parameters
#---------------------------------------------------------------------------

# Jinja template names used
aedir_web2ldap_cnf_local: "web2ldapcnf_local.py.j2"
aedir_web2ldap_connect_template: "web2ldap_connect.html.j2"
